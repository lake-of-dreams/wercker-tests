build:
  # The build step doesm't do very much and is just a launchpad for other pipelines
  box: alpine
  steps:
    - script: 
        name: Check environment variables
        code: 
    - script:
        name: Unit tests
        code: |
          if [[ -z "$USERNAME" ]]; then
            echo Environment variable \$USERNAME is not set
            exit 1
          fi   
          if [[ -z "$PASSWORD" ]]; then
            echo Environment variable \$PASSWORD is not set
            exit 1
          fi             
test-docker-build1:
  # Test the docker-build step
  box: google/golang
  steps:
    - internal/docker-build: 
        dockerfile: Dockerfile 
        image-name: my-new-image # name used to refer to this image until it's pushed   
#    - internal/docker-run:
#        image: my-new-image
#        name: myTestContainer     
#    - script: 
#        name: Test the container
#        code: |
#            if curlOutput=`curl -s myTestContainer:5000`; then 
#                if [ "$curlOutput" == "Hello World!!" ]; then
#                    echo "Test passed: container gave expected response"
#                else
#                    echo "Test failed: container gave unexpected response: " $curlOutput
#                    exit 1
#                fi   
#            else 
#                echo "Test failed: container did not respond"
#                exit 1
#            fi        
#    - internal/docker-kill:
#        name: myTestContainer               
    - internal/docker-push: 
        image-name: my-new-image
        username: $USERNAME # Docker Hub username. When using CLI, set using "export X_USERNAME=<username>"  
        password: $PASSWORD # Docker Hub password. When using CLI, set using "export X_PASSWORD=<password>" 
        repository: docker.io/$USERNAME/wercker-test
        tag: test-docker-build1
      